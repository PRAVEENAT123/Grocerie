<!-- recipe-section.liquid -->
{% schema %}
{
"name": "Recipe Section",
"settings": [
{
"type": "image_picker",
"id": "recipe_image",
"label": "Recipe Image"
},
{
"type": "text",
"id": "recipe_people",
"label": "Number of People",
"default": "4"
},
{
"type": "textarea",
"id": "recipe_instructions",
"label": "Recipe Instructions"
}
],
"blocks": [
{
"type": "ingredient",
"name": "Ingredient",
"settings": [
{
"type": "text",
"id": "ingredient_name",
"label": "Ingredient Name"
},
{
"type": "text",
"id": "ingredient_measurement",
"label": "Measurement (e.g., 200g)"
},
{
"type": "product",
"id": "ingredient_product",
"label": "Associated Product"
}
]
}
],
"presets": [
{
"name": "Recipe Section",
"category": "Custom"
}
]
}
{% endschema %}

<div class="recipe-section">
    <!-- Recipe Image -->
    {% if section.settings.recipe_image %}
    <img src="{{ section.settings.recipe_image | file_url }}" alt="Recipe Image" class="recipe-image" />
    {% endif %}

    <!-- Number of People -->
    <div class="recipe-people mb-4">
        <strong>Serves:</strong>
        <input type="number" id="recipePeople" value="{{ section.settings.recipe_people }}" class="border p-2 rounded"
            onchange="updateIngredients()" />
    </div>

    <!-- Recipe Instructions -->
    <div class="recipe-instructions mb-4">
        <h3 class="text-lg font-semibold">Instructions:</h3>
        <p>{{ section.settings.recipe_instructions }}</p>
    </div>

    <!-- Ingredients List -->
    <div class="recipe-ingredients">
        <h3 class="text-lg font-semibold">Ingredients:</h3>
        <ul id="ingredientsList">
            {% for block in section.blocks %}
            {% if block.type == 'ingredient' %}
            <li class="mb-2">
                <div class="flex items-center space-x-2">
                    <span class="font-medium">{{ block.settings.ingredient_name }}:</span>
                    <span id="ingredient{{ forloop.index }}_measurement">{{ block.settings.ingredient_measurement
                        }}</span>
                </div>
                {% if block.settings.ingredient_product %}
                <div class="mt-2">
                    <a href="{{ block.settings.ingredient_product | product_url }}" class="text-blue-500">View
                        Product</a>
                    <img src="{{ block.settings.ingredient_product.featured_image | img_url: 'small' }}"
                        alt="{{ block.settings.ingredient_name }}" class="w-16 h-16 object-cover mt-2" />
                </div>
                {% endif %}
            </li>
            {% endif %}
            {% endfor %}
        </ul>
    </div>
</div>

<script>
    function updateIngredients() {
        const numberOfPeople = document.getElementById('recipePeople').value;
        const ingredientBlocks = {{ section.blocks | json
    }};

    ingredientBlocks.forEach((block, index) => {
        if (block.type === 'ingredient') {
            const ingredientMeasurement = block.settings.ingredient_measurement;
            const quantity = parseFloat(ingredientMeasurement);

            if (!isNaN(quantity)) {
                const newMeasurement = (quantity * numberOfPeople) + ingredientMeasurement.slice(ingredientMeasurement.indexOf('g'));
                document.getElementById('ingredient' + (index + 1) + '_measurement').textContent = newMeasurement;
            }
        }
    });
  }
</script>

<style>
    /* Tailwind CSS styling, customize as needed */
    .recipe-section {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
    }

    .recipe-image {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
    }
</style>